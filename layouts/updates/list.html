{{ define "main" }}

<div class="updates-header">
	<h1>{{ .Title }}</h1>
	<p class="section-description">{{ .Content }}</p>
</div>

<div class="h-feed updates-feed">
	{{ $pages := where .Site.RegularPages ".Params.categories" "intersect" (slice "updates") }}
	{{ $paginator := .Paginate $pages 15 }}
	
	{{ range $paginator.Pages }}
		<article class="h-entry post-preview">
			<header class="post-header">
				{{ if .Title }}
					<h2 class="p-name post-title">
						<a href="{{ .Permalink }}">{{ .Title }}</a>
					</h2>
				{{ end }}
				
				<div class="post-meta">
					<time class="dt-published" datetime="{{ .Date.Format "2006-01-02T15:04:05-0700" }}">
						{{ .Date.Format "January 2, 2006" }}
					</time>
					{{ with .Params.author }}
						by <span class="p-author h-card">{{ . }}</span>
					{{ end }}
					{{ if .Params.categories }}
						<span class="post-categories">
							{{ range .Params.categories }}
								<span class="category-badge">{{ . }}</span>
							{{ end }}
						</span>
					{{ end }}
				</div>
			</header>

			<div class="p-summary post-summary">
				{{ if .Title }}
					{{ .Summary }}
				{{ else }}
					{{ .Content }}
				{{ end }}
			</div>

			{{ if .Params.photos }}
				<div class="post-photos-preview">
					{{ range first 3 .Params.photos }}
						<img src="{{ . }}" alt="" loading="lazy">
					{{ end }}
					{{ if gt (len .Params.photos) 3 }}
						<span class="more-photos">+{{ sub (len .Params.photos) 3 }} more</span>
					{{ end }}
				</div>
			{{ end }}

			<div class="post-footer">
				<a href="{{ .Permalink }}" class="u-url read-more">Read more →</a>
			</div>
		</article>
	{{ end }}

	{{ if or $paginator.HasPrev $paginator.HasNext }}
		<nav class="pagination">
			{{ if $paginator.HasPrev }}
				<a href="{{ $paginator.Prev.URL }}" class="pagination-prev">← Newer posts</a>
			{{ end }}
			
			<span class="pagination-info">
				Page {{ $paginator.PageNumber }} of {{ $paginator.TotalPages }}
			</span>
			
			{{ if $paginator.HasNext }}
				<a href="{{ $paginator.Next.URL }}" class="pagination-next">Older posts →</a>
			{{ end }}
		</nav>
	{{ end }}
</div>

{{ end }}
