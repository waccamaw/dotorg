{{ define "main" }}

<div class="updates-feed">
	<h1 onclick="toggleCategoryFilter()" style="cursor: pointer;">
		{{ .Title }}
		<svg class="filter-icon" id="filterIcon" xmlns="http://www.w3.org/2000/svg" width="28" height="28" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
			<polygon points="22 3 2 3 10 12.46 10 19 14 21 14 12.46 22 3"></polygon>
		</svg>
	</h1>
	
	{{ $allPosts := where .Site.RegularPages "Type" "post" }}
	
	<!-- Category Filter -->
	{{ $categories := slice }}
	{{ range $allPosts }}
		{{ range .Params.categories }}
			{{ $categories = $categories | append . }}
		{{ end }}
	{{ end }}
	{{ $categories = $categories | uniq }}
	
	{{ if $categories }}
	<div class="category-filter" id="categoryFilter" style="display: none;">
		<div class="category-links">
			<a href="/updates/" class="category-link">All</a>
			{{ range sort $categories }}
				<a href="/categories/{{ . | urlize }}/" class="category-link">{{ . }}</a>
			{{ end }}
		</div>
	</div>
	{{ end }}

	<script>
	function toggleCategoryFilter() {
		const filter = document.getElementById('categoryFilter');
		const icon = document.getElementById('filterIcon');
		
		if (filter.style.display === 'none') {
			filter.style.display = 'block';
			setTimeout(() => {
				filter.classList.add('show');
			}, 10);
			icon.style.transform = 'rotate(180deg)';
		} else {
			filter.classList.remove('show');
			setTimeout(() => {
				filter.style.display = 'none';
			}, 300);
			icon.style.transform = 'rotate(0deg)';
		}
	}
	</script>
	
	<!-- Show first 10 posts -->
	{{ $displayPosts := first 10 $allPosts }}
	
	{{ range $displayPosts }}
		<article class="h-entry post-preview">
			<header class="post-header">
				{{ if .Title }}
					<h3 class="p-name post-title">
						<a href="{{ .Permalink }}">{{ .Title }}</a>
					</h3>
				{{ end }}
				
				<div class="post-meta">
					<time class="dt-published" datetime="{{ .Date.Format "2006-01-02T15:04:05-0700" }}">
						{{ .Date.Format "January 2, 2006" }}
					</time>
					{{ with .Params.author }}
						{{ if reflect.IsMap . }}
							by <span class="p-author h-card">
								{{ with .avatar }}<img src="{{ . }}" alt="{{ $.Params.author.full_name }}" class="author-avatar"> {{ end }}
								{{ .full_name | default .name }}
							</span>
						{{ else }}
							by <span class="p-author h-card">{{ . }}</span>
						{{ end }}
					{{ end }}
					{{ if .Params.categories }}
						<span class="post-categories">
							{{ range .Params.categories }}
								<a href="/categories/{{ . | urlize }}/" class="category-badge">{{ . }}</a>
							{{ end }}
						</span>
					{{ end }}
				</div>
			</header>

			<div class="p-summary post-summary">
				{{ if .Title }}
					{{ .Summary }}
				{{ else }}
					{{ .Content }}
				{{ end }}
			</div>

			{{ if .Params.photos }}
				<div class="post-photos-preview">
					{{ range first 3 .Params.photos }}
						<img src="{{ . }}" alt="" loading="lazy">
					{{ end }}
					{{ if gt (len .Params.photos) 3 }}
						<span class="more-photos">+{{ sub (len .Params.photos) 3 }} more</span>
					{{ end }}
				</div>
			{{ end }}

			<div class="post-footer">
				<a href="{{ .Permalink }}" class="u-url read-more">Read more →</a>
			</div>
		</article>
	{{ end }}
	
	<!-- Pagination -->
	<nav class="pagination">
		<span class="pagination-info">
			Showing {{ len $displayPosts }} of {{ len $allPosts }} total posts
		</span>
		<a href="/page/2/" class="pagination-next">Older posts →</a>
	</nav>
</div>

{{ end }}
