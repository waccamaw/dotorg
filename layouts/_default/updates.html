{{ define "main" }}

<div class="updates-page">
	<header class="page-header">
		<h1 class="page-title">{{ .Title }}</h1>
		{{ if .Content }}
		<div class="page-description">
			{{ .Content }}
		</div>
		{{ end }}
	</header>

	{{- $updates := where .Site.RegularPages ".Params.categories" "intersect" (slice "updates") -}}
	{{- $updates = sort $updates ".Date" "desc" -}}
	
	<div class="h-feed updates-feed">
		{{ range $updates }}
			<article class="h-entry post-preview">
				<header class="post-header">
					{{ if .Title }}
						<h2 class="p-name post-title">
							<a href="{{ .RelPermalink }}">{{ .Title }}</a>
						</h2>
					{{ end }}
					
					<div class="post-meta">
						<time class="dt-published" datetime="{{ .Date.Format "2006-01-02T15:04:05-0700" }}">
							{{ .Date.Format "January 2, 2006" }}
						</time>
						{{ with .Params.author }}
							by <span class="p-author h-card">{{ . }}</span>
						{{ end }}
					{{ if .Params.categories }}
						<span class="post-categories">
							{{ range .Params.categories }}
								<span class="category-badge">{{ . }}</span>
							{{ end }}
						</span>
					{{ end }}
					</div>
				</header>

				<div class="p-summary post-summary">
					{{ if .Title }}
						{{ .Summary }}
					{{ else }}
						{{ .Content }}
					{{ end }}
				</div>

				{{ if .Params.photos }}
					<div class="post-photos-preview">
						{{ range first 3 .Params.photos }}
							<img src="{{ . }}" alt="" loading="lazy">
						{{ end }}
						{{ if gt (len .Params.photos) 3 }}
							<span class="more-photos">+{{ sub (len .Params.photos) 3 }} more</span>
						{{ end }}
					</div>
				{{ end }}

				<div class="post-footer">
					<a href="{{ .RelPermalink }}" class="u-url read-more">Read more â†’</a>
				</div>
			</article>
		{{ end }}
	</div>
</div>

{{ end }}
