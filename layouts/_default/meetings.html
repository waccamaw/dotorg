{{ define "main" }}

<div class="meetings-page">
	<header class="page-header">
		<h1 class="page-title">{{ .Title }}</h1>
		{{ if .Content }}
		<div class="page-description">
			{{ .Content }}
		</div>
		{{ end }}
	</header>

	{{- $allPages := .Site.RegularPages -}}
	{{- $meetings := slice -}}
	{{- range $allPages -}}
		{{- $titleLower := lower .Title -}}
		{{- $urlPath := .RelPermalink -}}
		{{- $fileName := path.Base .File.Path -}}
		{{- if and (or (in $titleLower "meeting") (in $titleLower "executive") (in $fileName "meeting")) (ne $urlPath "/meetings/") (gt .Date.Year 2000) -}}
			{{- $meetings = $meetings | append . -}}
		{{- end -}}
	{{- end -}}
	{{- $meetings = sort $meetings ".Date" "desc" -}}
	
	<div class="meetings-stats">
		<div class="stat-card">
			<span class="stat-number">{{ len $meetings }}</span>
			<span class="stat-label">Total Meetings</span>
		</div>
		<div class="stat-card">
			<span class="stat-number">{{ len (where $meetings ".Date.Year" "eq" 2025) }}</span>
			<span class="stat-label">2025 Meetings</span>
		</div>
		<div class="stat-card">
			<span class="stat-number">{{ len (where $meetings ".Date.Year" "eq" 2024) }}</span>
			<span class="stat-label">2024 Meetings</span>
		</div>
	</div>

	<div class="meetings-list">
		{{ $currentYear := "" }}
		{{ range $meetings }}
			{{ $year := .Date.Format "2006" }}
			
			{{ if ne $year $currentYear }}
				{{ if ne $currentYear "" }}
					</div></div>
				{{ end }}
				<div class="meetings-year">
					<h2 class="year-heading">{{ $year }} Meetings</h2>
					<div class="year-meetings">
			{{ end }}
			
			<a href="{{ .RelPermalink }}" class="meeting-item" data-year="{{ $year }}">
				<div class="meeting-calendar">
					<div class="calendar-month">{{ .Date.Format "Jan" }}</div>
					{{ if in .Title "Open Meeting" }}
						<div class="calendar-label">Open<br>Meeting</div>
					{{ else if in .Title "Executive" }}
						<div class="calendar-label">Executive</div>
					{{ else }}
						<div class="calendar-label">Meeting</div>
					{{ end }}
				</div>
				<div class="meeting-info">
					<h3 class="meeting-title">
						{{ .Title }}
					</h3>
				{{ with .Params.author }}
					{{ if reflect.IsMap . }}
						{{ if .full_name }}
							<span class="meeting-author">Posted by {{ .full_name }}</span>
						{{ end }}
					{{ else }}
						<span class="meeting-author">Posted by {{ . }}</span>
					{{ end }}
				{{ end }}
					{{ if .Summary }}
						<p class="meeting-summary">{{ .Summary | truncate 150 }}</p>
					{{ end }}
				</div>
			</a>
			
			{{ $currentYear = $year }}
		{{ end }}
		
		{{ if ne $currentYear "" }}
			</div></div>
		{{ end }}
	</div>
</div>

{{ end }}
